{{ define "content" }}
<div class="max-w-7xl mx-auto bg-white/90 dark:bg-gray-800/90 shadow-xl rounded-2xl p-6 mt-6">
  <h1 class="text-2xl font-extrabold text-indigo-700 dark:text-indigo-300 mb-6 flex items-center gap-2">
    <svg xmlns='http://www.w3.org/2000/svg' class='h-7 w-7 text-indigo-400' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z' /></svg>
    Permissions
  </h1>

  <!-- Search Filter Form -->
  <div class="mb-6">
    <form method="GET" action="/permissions" class="flex gap-4">
      <div class="flex-1 relative">
        <input type="text" name="filter" value="{{.Filter}}"
               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white"
               placeholder="Filter permissions...">
        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
          <svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 text-gray-400' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z' />
          </svg>
        </div>
      </div>
      <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 shadow transition flex items-center gap-1">
        Filter
      </button>
      {{ if .Filter }}
      <a href="/permissions" class="px-4 py-2 bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 shadow transition flex items-center gap-1">
        Clear
      </a>
      {{ end }}
    </form>
  </div>

  <!-- Permissions Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
      <thead class="bg-gray-50 dark:bg-gray-700">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">User ID</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Account ID</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Scope</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Value</th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
        {{ if .UserPermissions }}
          {{ range .UserPermissions }}
            {{ $perm := . }}
            {{ range .Permission.Value }}
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">{{ $perm.User.Username }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">{{ $perm.Permission.AccountId }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">{{ $perm.Permission.Type }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">{{ $perm.Permission.Scope }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300">{{ . }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <form method="POST" action="/accounts/{{$perm.Permission.AccountId}}/revoke" class="inline">
                  <input type="hidden" name="roleName" value="{{$perm.Permission.Scope}}" />
                  <input type="hidden" name="userId" value="{{$perm.Permission.UserId}}" />
                  <input type="hidden" name="value" value="{{.}}" />
                  <button class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 shadow transition flex items-center gap-1">
                    <svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12' /></svg>
                    Revoke
                  </button>
                </form>
              </td>
            </tr>
            {{ end }}
          {{ end }}
        {{ else }}
          <tr>
            <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
              <div class="flex flex-col items-center justify-center py-8">
                <svg xmlns='http://www.w3.org/2000/svg' class='h-12 w-12 mx-auto mb-2 text-indigo-200 dark:text-indigo-700' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M18.364 5.636l-1.414 1.414A9 9 0 105.636 18.364l1.414-1.414' /></svg>
                <div class="text-lg font-semibold">No permissions found</div>
                <div class="text-sm">No user permissions to display.</div>
              </div>
            </td>
          </tr>
        {{ end }}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="mt-6 text-right">
    {{ if .StartToken }}
    <form method="GET" action="/accounts/{{.Account.Id}}/permissions" class="inline-block">
      <input type="hidden" name="page" value="{{.StartToken}}" />
      {{ if .Filter }}
      <input type="hidden" name="filter" value="{{.Filter}}" />
      {{ end }}
      <button class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 shadow transition flex items-center gap-1">
        Next &rarr;
      </button>
    </form>
    {{ end }}
  </div>
</div>
{{ end }}
{{ template "layout" . }} 