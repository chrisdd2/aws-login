<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.AppName}} - Configuration</title>
    <link rel="stylesheet" href="/static/tailwind.css">
    <link rel="stylesheet" href="/static/font-awesome.css">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/github-dark.min.css">

</head>

<body
    class="min-h-screen flex flex-col bg-gradient-to-br from-indigo-500 to-purple-600 dark:from-[#1a1a2e] dark:to-[#16213e] transition-colors duration-300">
    <!-- Top Navigation Bar -->
    <nav class="bg-white/95 dark:bg-[#1a1a2e]/95 backdrop-blur-lg shadow-lg dark:shadow-[0_2px_10px_rgba(0,0,0,0.5)] transition-all duration-300"
        role="navigation" aria-label="main navigation">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-6">
                    <a class="flex items-center gap-2 font-bold text-gray-900 dark:text-white hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors"
                        confighref="/">
                        <i class="fas fa-cloud"></i>
                        <span>{{.AppName}}</span>
                    </a>
                    {{if .HasAdmin}}
                    <a href="/admin" class="text-sm font-medium text-indigo-600 dark:text-indigo-300 hover:underline">
                        Admin
                    </a>
                    <a href="/config" class="text-sm font-medium text-indigo-600 dark:text-indigo-300 hover:underline">
                        Configuration
                    </a>
                    {{end}}
                </div>
                <div class="flex items-center gap-4">
                    <a href="/logout"
                        class="cursor-pointer p-2 rounded bg-transparent border-none hover:bg-black/5 dark:hover:bg-white/10 transition-colors text-red-500 dark:text-red-400"
                        aria-label="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm uppercase">
                            {{if .Username}}{{printf "%.1s" .Username}}{{else}}<i class="fas fa-user"></i>{{end}}
                        </div>
                        <span class="text-gray-700 dark:text-white">{{if
                            .Username}}{{.Username}}{{else}}Loading...{{end}}</span>
                        <span class="text-green-500">
                            <i class="fas fa-circle text-xs"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="p-8 flex-1 flex flex-col items-justify">
        <!-- Toolbar -->
        <div class="flex items-center gap-1 z-10 bg-white/90 dark:bg-[#1a1a2e]/90 backdrop-blur-sm rounded-lg px-3 py-2 shadow-sm border border-gray-200 dark:border-gray-700 w-fit">
            <a href="/config/reload" class="flex items-center gap-1.5 text-xs px-3 py-1.5 rounded
                 bg-indigo-600 hover:bg-indigo-700
                 text-white shadow transition-colors">
                <i class="fas fa-sync-alt"></i>
                Reload
            </a>
            <a href="/config/sync" class="flex items-center gap-1.5 text-xs px-3 py-1.5 rounded
                 bg-indigo-600 hover:bg-indigo-700
                 text-white shadow transition-colors">
                <i class="fas fa-sync-alt"></i>
                Sync Users
            </a>

            <div class="w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1"></div>

            <form action="/config/import" method="post" enctype="multipart/form-data" class="contents">
                <input type="file" name="file" id="importFile" accept=".yml,.yaml" class="hidden">
                <button type="button" onclick="document.getElementById('importFile').click()"
                class="flex items-center gap-1.5 text-xs px-3 py-1.5 rounded
                bg-gray-600 hover:bg-gray-500
                text-white shadow transition-colors">
                    <i class="fas fa-file-import"></i>
                    Import
                </button>
            </form>


            <a href="/config/export" class="flex items-center gap-1.5 text-xs px-3 py-1.5 rounded
                 bg-gray-600 hover:bg-gray-500
                 text-white  transition-colors"
                 download="export.yml"
                 >
                <i class="fas fa-file-export"></i>
                Export
            </a>

            <div class="w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1"></div>

            <a href="/config/shutdown" class="flex items-center gap-1.5 text-xs px-3 py-1.5 rounded
                 bg-red-600 hover:bg-red-700
                 text-white shadow transition-colors">
                <i class="fas fa-power-off"></i>
                Shutdown
            </a>
        </div>
        {{if .Changes}}
        <!-- Import Changes Summary -->
        <div class="mb-6 bg-white dark:bg-[#1a1a2e] rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden -mt-0.5">
            <div class="px-4 py-2 bg-gray-100 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-200">Import Results</h3>
            </div>
            <div class="p-4">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs uppercase bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400">
                        <tr>
                            <th class="px-3 py-2">Action</th>
                            <th class="px-3 py-2">Type</th>
                            <th class="px-3 py-2">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Changes}}
                        <tr class="border-b dark:border-gray-700 dark:text-gray-300">
                            <td class="px-3 py-2">
                                {{if eq .Action "delete"}}
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400">
                                    <i class="fas fa-trash-alt mr-1"></i>delete
                                </span>
                                {{else if eq .Action "update"}}
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400">
                                    <i class="fas fa-edit mr-1"></i>update
                                </span>
                                {{else if eq .Action "create"}}
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400">
                                    <i class="fas fa-plus mr-1"></i>create
                                </span>
                                {{else}}
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300">
                                    {{.Action}}
                                </span>
                                {{end}}
                            </td>
                            <td class="px-3 py-2 font-medium text-gray-700 dark:text-gray-300">{{.ObjectType}}</td>
                            <td class="px-3 py-2 font-mono text-xs text-gray-600 dark:text-gray-400">{{.Value}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
                {{$create := 0}}{{$update := 0}}{{$delete := 0}}
                {{range .Changes}}{{if eq .Action "create"}}{{$create = inc $create}}{{end}}{{if eq .Action "update"}}{{$update = inc $update}}{{end}}{{if eq .Action "delete"}}{{$delete = inc $delete}}{{end}}{{end}}
                <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400">
                    <span class="font-medium">Summary:</span>
                    {{if gt $create 0}}<span class="text-green-600 dark:text-green-400 mx-1">{{$create}} created</span>{{end}}
                    {{if gt $update 0}}<span class="text-yellow-600 dark:text-yellow-400 mx-1">{{$update}} updated</span>{{end}}
                    {{if gt $delete 0}}<span class="text-red-600 dark:text-red-400 mx-1">{{$delete}} deleted</span>{{end}}
                </div>
            </div>
        </div>
        {{end}}
        
        <div id="configuration" class="flex flex-col -mt-0.5 w-full">
            <!-- Tab Navigation -->
            <div class="flex gap-1 bg-white dark:bg-[#1a1a2e] px-4 pt-4 rounded-t-lg overflow-hidden" role="tablist">
                <button id="tab-users" class="tab-button text-xs px-3 py-1.5 rounded-t-lg bg-indigo-600 text-white" onclick="selectTab('users')" role="tab">Users</button>
                <button id="tab-accounts" class="tab-button text-xs px-3 py-1.5 rounded-t-lg bg-gray-400 dark:bg-gray-600 text-white" onclick="selectTab('accounts')" role="tab">Accounts</button>
                <button id="tab-roles" class="tab-button text-xs px-3 py-1.5 rounded-t-lg bg-gray-400 dark:bg-gray-600 text-white" onclick="selectTab('roles')" role="tab">Roles</button>
                <button id="tab-policies" class="tab-button text-xs px-3 py-1.5 rounded-t-lg bg-gray-400 dark:bg-gray-600 text-white" onclick="selectTab('policies')" role="tab">Policies</button>
            </div>

            <!-- Tab Content -->
            <div class="yaml-content bg-white dark:bg-[#1a1a2e] rounded-b-lg rounded-t-none overflow-hidden" id="yaml-users">
                <div class="p-4">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                        <tr>
                            <th class="px-4 py-2 w-8"></th>
                            <th class="px-4 py-2">Name</th>
                            <th class="px-4 py-2">Friendly Name</th>
                            <th class="px-4 py-2">Superuser</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{$store := .Store}}
                        {{range $i, $user := $store.Users}}
                        <tr class="border-b dark:border-gray-700 dark:text-gray-300">
                            <td class="px-4 py-2">
                                <button onclick="toggleExpand('user-{{$i}}')" class="cursor-pointer p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">
                                    <i id="icon-user-{{$i}}" class="fas fa-chevron-right transition-transform"></i>
                                </button>
                            </td>
                            <td class="px-4 py-2 font-mono">{{.Name}}</td>
                            <td class="px-4 py-2">{{.FriendlyName}}</td>
                            <td class="px-4 py-2">
                                {{if .Superuser}}<i class="fas fa-check text-green-500"></i>{{else}}<i class="fas fa-times text-red-500"></i>{{end}}
                            </td>
                        </tr>
                        <tr id="user-{{$i}}" class="hidden">
                            <td colspan="4" class="px-4 py-2 bg-gray-50 dark:bg-gray-800/50">
                                {{$userRoles := filterRoleUserAttachments $store.RoleUserAttachments .Name}}
                                {{if $userRoles}}
                                <div class="pl-12">
                                    <table class="w-full text-xs">
                                        <thead class="text-xs uppercase bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                                            <tr>
                                                <th class="px-3 py-1">Role</th>
                                                <th class="px-3 py-1">Account</th>
                                                <th class="px-3 py-1">Permissions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{range $userRoles}}
                                            <tr class="border-b dark:border-gray-700">
                                                <td class="px-3 py-1 font-mono text-gray-700 dark:text-gray-300">{{.RoleName}}</td>
                                                <td class="px-3 py-1 font-mono text-gray-700 dark:text-gray-300">{{.AccountName}}</td>
                                                <td class="px-3 py-1">
                                                    {{range .Permissions}}
                                                    <span class="inline-block px-1.5 py-0.5 mr-1 bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 rounded text-xs">{{.}}</span>
                                                    {{end}}
                                                </td>
                                            </tr>
                                            {{end}}
                                        </tbody>
                                    </table>
                                </div>
                                {{else}}
                                <div class="pl-12 text-gray-500 dark:text-gray-400 text-xs italic">No roles assigned</div>
                                {{end}}
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
                </div>
            </div>
            <div class="yaml-content bg-white dark:bg-[#1a1a2e] rounded-b-lg rounded-t-none overflow-hidden hidden" id="yaml-accounts">
                <div class="p-4">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                        <tr>
                            <th class="px-4 py-2 w-8"></th>
                            <th class="px-4 py-2">Name</th>
                            <th class="px-4 py-2">AWS Account ID</th>
                            <th class="px-4 py-2">Disabled</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{$store := .Store}}
                        {{range $i, $account := $store.Accounts}}
                        <tr class="border-b dark:border-gray-700 dark:text-gray-300">
                            <td class="px-4 py-2">
                                <button onclick="toggleExpand('account-{{$i}}')" class="cursor-pointer p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">
                                    <i id="icon-account-{{$i}}" class="fas fa-chevron-right transition-transform"></i>
                                </button>
                            </td>
                            <td class="px-4 py-2 font-mono">{{.Name}}</td>
                            <td class="px-4 py-2 font-mono">{{.AwsAccountId}}</td>
                            <td class="px-4 py-2">
                                {{if .Disabled}}<i class="fas fa-check text-green-500"></i>{{else}}<i class="fas fa-times text-red-500"></i>{{end}}
                            </td>
                        </tr>
                        <tr id="account-{{$i}}" class="hidden">
                            <td colspan="4" class="px-4 py-2 bg-gray-50 dark:bg-gray-800/50">
                                {{$accountRoles := filterRoleAccountAttachments $store.RoleAccountAttachments .Name}}
                                {{if $accountRoles}}
                                <div class="pl-12">
                                    <span class="font-semibold text-xs uppercase text-gray-500 dark:text-gray-400">Roles:</span>
                                    <ul class="list-disc list-inside ml-2 mt-1 font-mono text-xs text-gray-700 dark:text-gray-300">
                                        {{range $accountRoles}}
                                        <li class="text-gray-700 dark:text-gray-300">{{.RoleName}}</li>
                                        {{end}}
                                    </ul>
                                </div>
                                {{else}}
                                <div class="pl-12 text-gray-500 dark:text-gray-400 text-xs italic">No roles attached</div>
                                {{end}}
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
                </div>
            </div>
            <div class="yaml-content bg-white dark:bg-[#1a1a2e] rounded-b-lg rounded-t-none overflow-hidden hidden" id="yaml-roles">
                <div class="p-4">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                        <tr>
                            <th class="px-4 py-2 w-8"></th>
                            <th class="px-4 py-2">Name</th>
                            <th class="px-4 py-2">Max Session</th>
                            <th class="px-4 py-2">Disabled</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{$store := .Store}}
                        {{range $i, $role := $store.Roles}}
                        <tr class="border-b dark:border-gray-700 dark:text-gray-300">
                            <td class="px-4 py-2">
                                <button onclick="toggleExpand('role-{{$i}}')" class="cursor-pointer p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">
                                    <i id="icon-role-{{$i}}" class="fas fa-chevron-right transition-transform"></i>
                                </button>
                            </td>
                            <td class="px-4 py-2 font-mono">{{.Name}}</td>
                            <td class="px-4 py-2">{{.MaxSessionDuration}}</td>
                            <td class="px-4 py-2">
                                {{if .Disabled}}<i class="fas fa-check text-green-500"></i>{{else}}<i class="fas fa-times text-red-500"></i>{{end}}
                            </td>
                        </tr>
                        <tr id="role-{{$i}}" class="hidden">
                            <td colspan="4" class="px-4 py-2 bg-gray-50 dark:bg-gray-800/50">
                                {{$rolePolicies := filterRolePolicyAttachments $store.RolePolicyAttachments .Name}}
                                <div class="pl-12 space-y-2">
                                    {{if $rolePolicies}}
                                    <div>
                                        <span class="font-semibold text-xs uppercase text-gray-500 dark:text-gray-400">Policy Attachments:</span>
                                        <ul class="list-disc list-inside ml-2 mt-1 font-mono text-xs text-gray-700 dark:text-gray-300">
                                            {{range $rolePolicies}}
                                            <li class="text-gray-700 dark:text-gray-300">{{.PolicyId}}</li>
                                            {{end}}
                                        </ul>
                                    </div>
                                    {{end}}
                                    {{if .ManagedPolicies}}
                                    <div>
                                        <span class="font-semibold text-xs uppercase text-gray-500 dark:text-gray-400">Managed Policies:</span>
                                        <ul class="list-disc list-inside ml-2 mt-1 font-mono text-xs text-gray-700 dark:text-gray-300">
                                            {{range .ManagedPolicies}}
                                            <li class="text-gray-700 dark:text-gray-300">{{.}}</li>
                                            {{end}}
                                        </ul>
                                    </div>
                                    {{end}}
                                </div>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
                </div>
            </div>
            <div class="yaml-content bg-white dark:bg-[#1a1a2e] rounded-b-lg rounded-t-none overflow-hidden hidden" id="yaml-policies">
                <div class="p-4">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                        <tr>
                            <th class="px-4 py-2 w-8"></th>
                            <th class="px-4 py-2">ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range $i, $policy := .Store.Policies}}
                        <tr class="border-b dark:border-gray-700 dark:text-gray-300">
                            <td class="px-4 py-2">
                                <button onclick="toggleExpand('policy-{{$i}}')" class="cursor-pointer p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">
                                    <i id="icon-policy-{{$i}}" class="fas fa-chevron-right transition-transform"></i>
                                </button>
                            </td>
                            <td class="px-4 py-2 font-mono">{{.Id}}</td>
                        </tr>
                        <tr id="policy-{{$i}}" class="hidden">
                            <td colspan="2" class="px-4 py-2 bg-gray-50 dark:bg-gray-800/50">
                                <div class="pl-12">
                                    <span class="font-semibold text-xs uppercase text-gray-500 dark:text-gray-400">Document:</span>
                                    <pre class="mt-1 p-2 bg-gray-100 dark:bg-gray-900 rounded font-mono text-xs overflow-x-auto text-gray-800 dark:text-gray-200"><code class="language-json">{{.Document}}</code></pre>
                                </div>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
                </div>
            </div>
        </div>
    </div>


    <!-- Bottom Footer Bar -->
    <footer
        class="bg-white/95 dark:bg-[#1a1a2e]/95 backdrop-blur-lg shadow-lg dark:shadow-[0_-2px_10px_rgba(0,0,0,0.5)] py-6 transition-all duration-300">
        <div class="container mx-auto px-4 text-center">
            <p class="font-semibold text-gray-900 dark:text-white mb-1">
                <strong>{{.AppName}}</strong> - Secure access to your AWS accounts
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-400">
                <i class="fas fa-shield-alt mr-1"></i>
                Your credentials are securely managed
            </p>
        </div>
    </footer>
    <script src="/static/highlight.min.js"></script>
    <script>
        document.getElementById('importFile').addEventListener('change', function(e) {
            if (this.files.length > 0) {
                this.form.submit();
            }
        });

        function selectTab(key) {
            document.querySelectorAll('.yaml-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(el => {
                el.classList.remove('bg-indigo-600');
                el.classList.add('bg-gray-400', 'dark:bg-gray-600');
            });
            document.getElementById('yaml-' + key).classList.remove('hidden');
            document.getElementById('tab-' + key).classList.remove('bg-gray-400', 'dark:bg-gray-600');
            document.getElementById('tab-' + key).classList.add('bg-indigo-600');
            hljs.highlightAll();
        }

        function toggleExpand(id) {
            const row = document.getElementById(id);
            const icon = document.getElementById('icon-' + id);
            if (row.classList.contains('hidden')) {
                row.classList.remove('hidden');
                icon.classList.add('rotate-90');
            } else {
                row.classList.add('hidden');
                icon.classList.remove('rotate-90');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const firstTab = document.querySelector('.tab-button');
            if (firstTab) {
                selectTab(firstTab.id.replace('tab-', ''));
            }
        });
    </script>


</body>

</html>